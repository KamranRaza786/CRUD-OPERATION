<!-- index.html -->

<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ... (previous code) -->
</head>

<body>
  <!-- ... (previous code) -->
  <div id="studentList">
    <!-- Student list will be displayed here -->
  </div>

  <script src="index.js"></script>
  <script>
    const studentListDiv = document.getElementById('studentList');

    // Function to display students in the list
    function displayStudents(students) {
      studentListDiv.innerHTML = '';
      students.forEach(student => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `
          <span>${student.name} (ID: ${student._id}) - Age: ${student.age}</span>
          <button class="edit-btn" onclick="editStudent('${student._id}', '${student.name}', ${student.age})">Edit</button>
          <button class="delete-btn" onclick="deleteStudent('${student._id}')">Delete</button>
        `;
        studentListDiv.appendChild(listItem);
      });
    }

    // Fetch students from the server and display them
    fetch('/students')
      .then(response => response.json())
      .then(students => displayStudents(students))
      .catch(err => console.error('Error fetching students:', err));

    // Function to handle form submission for adding a new student
    document.getElementById('studentForm').addEventListener('submit', (event) => {
      event.preventDefault();
      const name = document.getElementById('name').value;
      const age = document.getElementById('age').value;
      fetch('/students', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name, age })
      })
      .then(response => response.json())
      .then(newStudent => {
        const studentList = document.querySelectorAll('#studentList li');
        const lastStudent = studentList[studentList.length - 1];
        if (lastStudent) {
          lastStudent.insertAdjacentHTML('afterend', `
            <li>
              <span>${newStudent.name} (ID: ${newStudent._id}) - Age: ${newStudent.age}</span>
              <button class="edit-btn" onclick="editStudent('${newStudent._id}', '${newStudent.name}', ${newStudent.age})">Edit</button>
              <button class="delete-btn" onclick="deleteStudent('${newStudent._id}')">Delete</button>
            </li>
          `);
        } else {
          displayStudents([newStudent]);
        }
      })
      .catch(err => console.error('Error adding student:', err));
      document.getElementById('studentForm').reset();
    });

    // Function to handle student deletion
    function deleteStudent(studentId) {
      fetch(`/students/${studentId}`, {
        method: 'DELETE'
      })
      .then(response => response.json())
      .then(deletedStudent => {
        const listItem = document.querySelector(`#studentList li span[data-student-id="${studentId}"]`).parentElement;
        listItem.remove();
      })
      .catch(err => console.error('Error deleting student:', err));
    }

    // Function to handle student editing
    function editStudent(studentId, studentName, studentAge) {
      const updatedName = prompt('Enter the updated student name:', studentName);
      const updatedAge = prompt('Enter the updated student age:', studentAge);
      if (updatedName && updatedAge) {
        fetch(`/students/${studentId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name: updatedName, age: updatedAge })
        })
        .then(response => response.json())
        .then(updatedStudent => {
          const listItem = document.querySelector(`#studentList li span[data-student-id="${studentId}"]`);
          listItem.textContent = `${updatedStudent.name} (ID: ${updatedStudent._id}) - Age: ${updatedStudent.age}`;
        })
        .catch(err => console.error('Error updating student:', err));
      }
    }
  </script>
</body>

</html>
